---
title: 深度学习工具应该是什么样的
date: 2023-11-13 21:08:19
tags:
---

# 为什么有这个问题
1. 深度学习工具链并非不完全，但是集成程度比较高（也许？），也可能是我没有用过很多的工具，先去调查一下
2. 确实没有很多工具，主要还是一堆框架，当然有很多模块是可以帮助画图、可视化之类的（**hugging face**确实很方便，但是对研究可能差点意思）
3. 所以我们还是需要自己搞一个工具的（也许？），可以高度契合我们的研究领域，同时实现高效的科研

# 我们的工具需要具备什么功能，或者说怎么构成
所以写这篇内容只是为了整理一下思路并且记录下来，如果不这么做感觉思路上不是很清晰，代码工具有可能写的不是很好。

那么训练和测试神经网络的主要内容有：**数据处理**、**模型定义**、**损失函数**、**训练流程**、**性能测试**、**结果可视化**、**DEBUG等其他工具**

## 数据处理
首先数据处理包括两个方面：**处理方法**、**数据集内容**

- 数据集内容：这部分通常在很长时间里不会变，比如读研的三年，因此可以先收集领域主要使用的数据集都存下来，然后分别根据特性给出一个处理流程
- 处理方法：这部分通常有可能根据研究的情况发生变化，因此需要不断地加入和更新，我们应当使加入和更新不那么困难，或者说非常简单

因此解决办法是：对每个数据集提供一个处理流程，可以产生对应数据集的主要信息，包括：图像路径、读取和可能的预处理，即return path，read(path)，preprocess，（表现为可能有一些h5数据）

然后处理方法只需要调用数据集提供的接口，就可以快速地读取想要的信息，然后进行自己的处理，处理方法应当提供为pytorch中的一个DataSet类供训练调用

## 模型定义
模型定义通常就定义一个model文件，然后继承nn.module就可以了（大部分？），这部分通常独立于其他部分之外，交互的内容很少，主要在于如何管理

把一堆模型文件定义成不同的名字然后放到一起通常不太现实，看上去观感会比较差，还是分开放吧，根据实验的内容对实验的文件夹命名，然后在实验的里面定义model好了

但是可以定义一些常用的模块，方便调用，比如说大量卷积层的连接之类的、transformer这些，具有某种固定格式的，但是必要性不是很大，因为模型结构通常是改来改去的，更新非常频繁

## 损失函数
损失函数和模型常用模块类似，也这么定义一个文件就行

## 训练流程
针对训练流程，我们能够集成什么内容呢，感觉没有什么能够集成的了，具体来说，流程代码不多，可以集成一下：**模型保存**、**训练数据保存**就差不多了

## 性能测试
训练搞的花活可能比较多，但是测试应当不会搞什么花活，推理结果应当是要直接和GT进行比较然后计算误差的，因此可以集成**所有种类误差的计算方法**、**测试结果保存**，其他的也没有集成的必要，变动频繁且比较大

但是**带有随机性的数据处理方式**应当配备一个把测试集转换到指定要求的数据类型的函数，这个函数可以放在各个数据集里面，每个数据集一个，运行一次就OK，各个数据处理流程应当要区分是训练还是测试，从而给出不同的数据，可以用放在文件开头的参数的方式来方便地调节数据集的使用（放在测试和训练代码的开头，数据处理读入这个参数，然后根据参数返回数据）（但是取平均值也不错）

## 结果可视化
这部分通常没有大的变化，给定一定的可视化方法，这个方法通常就再也不会变化了，用来形成主观结果，因此集成这个部分非常有必要，统计主要的可视化方法，然后做一个集成

函数功能是给一个tensor直接出一张图；为了能快速编写可视化结果的代码，我们应当给数据处理部分集成一个**sample**的函数，方便地提取结果用于训练集可视化

主观结果通常是取几张图，客观结果通常是全部算完，因此测试集也应该提供一个**sample**函数用来快速获得测试集的主观结果

## DEBUG等其他工具
这部分就起名叫tools，如果有问题需要调试就应该使用这个文件的函数

应该包括如下内容：**打印tensor的信息**、**打印model的信息**、**打印dataset的信息**、**打印dict、list的信息**

# 总结一下
- 数据处理：
1. 搜集数据集，总一个数据集处理函数模块datatool，包括若干py文件，以数据集名字命名，做一个类，里面包括返回list和从list索引读取的sample函数，test和train不做两个函数，用参数判断一下，顺便给个名字
2. 每个实验自己维护一个数据读取方式，作为dataset，使用前述的函数读数据
- 模型定义：
总一个文件modeltool.py，**直接包括常用的结构**
- 损失函数：
总一个文件losstool.py，**直接包括常用的损失**
- 训练流程：
总一个文件traintool.py，**包括读取模型、保存模型和保存训练数据的函数，训练数据直接存一个dict，模型存pt**
- 性能测试：
总一个testtool.py文件，**包括误差计算和测试结果保存，测试结果也做成一个dict**
- 结果可视化：
总一个visiontool.py，**给一个tensor转成图并保存，地址自定义，多保存几种格式**
- DEBUG工具：
总一个debugtool.py，**包括打印tensor的信息、打印model的信息、打印dataset的信息、打印dict、list的信息**